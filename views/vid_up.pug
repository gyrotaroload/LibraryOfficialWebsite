html.pintura-editor-validated(lang='en')
  head
    // Force latest IE rendering engine or ChromeFrame if installed
    //if IE
      meta(http-equiv='X-UA-Compatible' content='IE=edge,chrome=1')
    meta(charset='utf-8')
    title jQuery File Upload Demo
    meta(name='description' content='File Upload widget with multiple file selection, drag&drop support, progress bars, validation and preview images, audio and video for jQuery. Supports cross-domain, chunked and resumable file uploads and client-side image resizing. Works with any server-side platform (PHP, Python, Ruby on Rails, Java, Node.js, Go etc.) that supports standard HTML form file uploads.')
    meta(name='viewport' content='width=device-width, initial-scale=1.0')
    // Bootstrap styles
    link(rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' integrity='sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u' crossorigin='anonymous')
    // [if gte IE 9] <!
    // Carbon Ads styles
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/gh/blueimp/jQuery-File-Upload@gh-pages/css/vendor/carbon.css')
    // Pintura Image Editor styles
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/gh/blueimp/jQuery-File-Upload@gh-pages/css/vendor/pintura.min.css')
    // <![endif]
    // Generic page styles
    style.
      #navigation {
      margin: 10px 0;
      }
      @media (max-width: 767px) {
      #title,
      #description {
      display: none;
      }
      }
    // blueimp Gallery styles
    link(rel='stylesheet' href='https://blueimp.github.io/Gallery/css/blueimp-gallery.min.css')
    // CSS to style the file input field as button and adjust the Bootstrap progress bars
    link(rel='stylesheet' href='/js/vendor/blueimp-file-upload/css/jquery.fileupload.css')
    link(rel='stylesheet' href='/js/vendor/blueimp-file-upload/css/jquery.fileupload-ui.css')
    // CSS adjustments for browsers with JavaScript disabled
    noscript
      link(rel='stylesheet' href='/js/vendor/blueimp-file-upload/css/jquery.fileupload-noscript.css')
    noscript
      link(rel='stylesheet' href='/js/vendor/blueimp-file-upload/css/jquery.fileupload-ui-noscript.css')
    script#_carbonads_projs(type='text/javascript' src='https://srv.carbonads.net/ads/CKYIL53M.json?segment=placement:blueimpgithubio&callback=_carbonads_go')
  body
    .container
      ul#navigation.nav.nav-tabs
        li
          a(href='https://github.com/blueimp/jQuery-File-Upload') Project
        li.active
          a(href='#') Demo
        li
          a(href='https://github.com/blueimp/jQuery-File-Upload/wiki') Wiki
        li
          a(href='https://blueimp.net') Author
      h1#title jQuery File Upload Demo
      blockquote#description
        p
          | File Upload widget with multiple file selection, drag&drop
          | support, progress bars, validation and preview images, audio and video
          | for jQuery.
          br
          |           Supports cross-domain, chunked and resumable file uploads and
          |           client-side image resizing.
          br
          |           Works with any server-side platform (PHP, Python, Ruby on Rails, Java,
          |           Node.js, Go etc.) that supports standard HTML form file uploads.
      // The file upload form used as target for the file upload widget
      form#fileupload(action='/upload' method='POST' enctype='multipart/form-data')
        // Redirect browsers with JavaScript disabled to the origin page
        noscript
          input(type='hidden' name='redirect' value='/upload')
        // The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload
        .row.fileupload-buttonbar
          .col-lg-7
            // The fileinput-button span is used to style the file input field as button
            span.btn.btn-success.fileinput-button
              i.glyphicon.glyphicon-plus
              span Add files...
              input(type='file' name='files[]' multiple='')
            button.btn.btn-primary.start(type='submit')
              i.glyphicon.glyphicon-upload
              span Start upload
            button.btn.btn-warning.cancel(type='reset')
              i.glyphicon.glyphicon-ban-circle
              span Cancel upload
            button.btn.btn-danger.delete(type='button')
              i.glyphicon.glyphicon-trash
              span Delete selected
            input.toggle(type='checkbox')
            // The global file processing state
            span.fileupload-process
          // The global progress state
          .col-lg-5.fileupload-progress.fade
            // The global progress bar
            .progress.progress-striped.active(role='progressbar' aria-valuemin='0' aria-valuemax='100')
              .progress-bar.progress-bar-success(style='width: 0%;')
            // The extended global progress state
            .progress-extended Â 
        // The table listing the files available for upload/download
        table.table.table-striped(role='presentation')
          tbody.files
      // [if gte IE 9] <!
      // Carbon Ads
      p
        script#_carbonads_js(async='' type='text/javascript' src='//cdn.carbonads.com/carbon.js?serve=CKYIL53M&placement=blueimpgithubio')
      #carbonads
        span
          span.carbon-wrap
            a.carbon-img(href='https://srv.carbonads.net/ads/click/x/GTND42JWFTYIEKJECKBLYKQNCEADTK7YCV7D4Z3JCYBDEK3NCTYDK23KC6YD4KJEFTSDTK7MCWAI6K37CWYI627YHEYIK23YC6ADT53ECTNCYBZ52K?segment=placement:blueimpgithubio;' target='_blank' rel='noopener sponsored')
              img(src='https://cdn4.buysellads.net/uu/1/3386/1525189943-38523.png' alt='ads via Carbon' border='0' height='100' width='130' style='max-width: 130px;')
            a.carbon-text(href='https://srv.carbonads.net/ads/click/x/GTND42JWFTYIEKJECKBLYKQNCEADTK7YCV7D4Z3JCYBDEK3NCTYDK23KC6YD4KJEFTSDTK7MCWAI6K37CWYI627YHEYIK23YC6ADT53ECTNCYBZ52K?segment=placement:blueimpgithubio;' target='_blank' rel='noopener sponsored') Limited time offer: Get 10 free Adobe Stock images.
          a.carbon-poweredby(href='http://carbonads.net/?utm_source=blueimpgithubio&utm_medium=ad_via_link&utm_campaign=in_unit&utm_term=carbon' target='_blank' rel='noopener sponsored') ads via Carbon
      p
      // Pintura Image Editor info
      .panel.panel-default
        .panel-heading
          h3.panel-title
            a(href='https://gumroad.com/a/75084915')
              img(src='https://cdn.jsdelivr.net/gh/blueimp/jQuery-File-Upload@gh-pages/img/vendor/pintura-logo.svg' alt='Pintura' style='max-width: 150px;')
        .panel-body
          p
            a(href='https://gumroad.com/a/75084915') Pintura Image Editor
            |             integrates smoothly with
            a(href='https://github.com/blueimp/jQuery-File-Upload') jQuery File Upload
            |             and creates a super fast image editing experience for your users.
          ul
            li Five Minute Install
            li Set Crop Masks and Guides
            li Define Aspect Ratio Options
            li Rotate, Resize, and Flip Images
            li Add Markup and Annotations
            li Color Adjustment Controls
            li Apply Filter Effects
          p
            a(href='https://gumroad.com/a/75084915') Learn more
      // <![endif]
      .panel.panel-default
        .panel-heading
          h3.panel-title Demo Notes
        .panel-body
          ul
            li
              | The maximum file size for uploads in this demo is
              strong 999 KB
              |  (default file size is unlimited).
            li
              | Only image files (
              strong JPG, GIF, PNG
              | ) are allowed in
              |               this demo (by default there is no file type restriction).
            li
              | Uploaded files will be deleted automatically after
              strong 5 minutes or less
              |  (demo files are stored in
              |               memory).
            li
              | You can 
              strong drag & drop
              |  files from your desktop
              |               on this webpage (see
              a(href='https://github.com/blueimp/jQuery-File-Upload/wiki/Browser-support') Browser support
              | ).
            li
              | Please refer to the
              a(href='https://github.com/blueimp/jQuery-File-Upload') project website
              |               and
              a(href='https://github.com/blueimp/jQuery-File-Upload/wiki') documentation
              |               for more information.
            li
              | Built with the
              a(href='https://getbootstrap.com/') Bootstrap
              |  CSS framework
              |               and Icons from 
              a(href='https://glyphicons.com/') Glyphicons
              | .
    // The blueimp Gallery widget
    #blueimp-gallery.blueimp-gallery.blueimp-gallery-controls(aria-label='image gallery' aria-modal='true' role='dialog' data-filter=':even')
      .slides(aria-live='polite')
      h3.title
      a.prev(aria-controls='blueimp-gallery' aria-label='previous slide' aria-keyshortcuts='ArrowLeft')
      a.next(aria-controls='blueimp-gallery' aria-label='next slide' aria-keyshortcuts='ArrowRight')
      a.close(aria-controls='blueimp-gallery' aria-label='close' aria-keyshortcuts='Escape')
      a.play-pause(aria-controls='blueimp-gallery' aria-label='play slideshow' aria-keyshortcuts='Space' aria-pressed='false' role='button')
      ol.indicator
    // The template to display files available for upload
    script#template-upload(type='text/x-tmpl').
      {% for (var i=0, file; file=o.files[i]; i++) { %}
      <tr class="template-upload fade{%=o.options.loadImageFileTypes.test(file.type)?' image':''%}">
      <td>
      <span class="preview"></span>
      </td>
      <td>
      <p class="name">{%=file.name%}</p>
      <strong class="error text-danger"></strong>
      </td>
      <td>
      <p class="size">Processing...</p>
      <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
      </td>
      <td>
      {% if (!o.options.autoUpload && o.options.edit && o.options.loadImageFileTypes.test(file.type)) { %}
      <button class="btn btn-success edit" data-index="{%=i%}" disabled>
      <i class="glyphicon glyphicon-edit"></i>
      <span>Edit</span>
      </button>
      {% } %}
      {% if (!i && !o.options.autoUpload) { %}
      <button class="btn btn-primary start" disabled>
      <i class="glyphicon glyphicon-upload"></i>
      <span>Start</span>
      </button>
      {% } %}
      {% if (!i) { %}
      <button class="btn btn-warning cancel">
      <i class="glyphicon glyphicon-ban-circle"></i>
      <span>Cancel</span>
      </button>
      {% } %}
      </td>
      </tr>
      {% } %}
    // The template to display files available for download
    script#template-download(type='text/x-tmpl').
      {% for (var i=0, file; file=o.files[i]; i++) { %}
      <tr class="template-download fade{%=file.thumbnailUrl?' image':''%}">
      <td>
      <span class="preview">
      {% if (file.thumbnailUrl) { %}
      <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
      {% } %}
      </span>
      </td>
      <td>
      <p class="name">
      {% if (file.url) { %}
      <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
      {% } else { %}
      <span>{%=file.name%}</span>
      {% } %}
      </p>
      {% if (file.error) { %}
      <div><span class="label label-danger">Error</span> {%=file.error%}</div>
      {% } %}
      </td>
      <td>
      <span class="size">{%=o.formatFileSize(file.size)%}</span>
      </td>
      <td>
      {% if (file.deleteUrl) { %}
      <button class="btn btn-danger delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
      <i class="glyphicon glyphicon-trash"></i>
      <span>Delete</span>
      </button>
      <input type="checkbox" name="delete" value="1" class="toggle">
      {% } else { %}
      <button class="btn btn-warning cancel">
      <i class="glyphicon glyphicon-ban-circle"></i>
      <span>Cancel</span>
      </button>
      {% } %}
      </td>
      </tr>
      {% } %}
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js' integrity='sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ' crossorigin='anonymous')
    // The jQuery UI widget factory, can be omitted if jQuery UI is already included
    script(src='/js/vendor/blueimp-file-upload/js/vendor/jquery.ui.widget.js')
    // The Templates plugin is included to render the upload/download listings
    script(src='https://blueimp.github.io/JavaScript-Templates/js/tmpl.min.js')
    // The Load Image plugin is included for the preview images and image resizing functionality
    script(src='https://blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js')
    // The Canvas to Blob plugin is included for image resizing functionality
    script(src='https://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js')
    // blueimp Gallery script
    script(src='https://blueimp.github.io/Gallery/js/jquery.blueimp-gallery.min.js')
    // The Iframe Transport is required for browsers without support for XHR file uploads
    script(src='/js/vendor/blueimp-file-upload/js/jquery.iframe-transport.js')
    // The basic File Upload plugin
    script(src='/js/vendor/blueimp-file-upload/js/jquery.fileupload.js')
    // The File Upload processing plugin
    script(src='/js/vendor/blueimp-file-upload/js/jquery.fileupload-process.js')
    // The File Upload image preview & resize plugin
    script(src='/js/vendor/blueimp-file-upload/js/jquery.fileupload-image.js')
    // The File Upload audio preview plugin
    script(src='/js/vendor/blueimp-file-upload/js/jquery.fileupload-audio.js')
    // The File Upload video preview plugin
    script(src='/js/vendor/blueimp-file-upload/js/jquery.fileupload-video.js')
    // The File Upload validation plugin
    script(src='/js/vendor/blueimp-file-upload/js/jquery.fileupload-validate.js')
    // The File Upload user interface plugin
    script(src='/js/vendor/blueimp-file-upload/js/jquery.fileupload-ui.js')
    // The main application script
    //script(src='https://cdn.jsdelivr.net/gh/blueimp/jQuery-File-Upload@gh-pages/js/demo.js')
    script(src='/mp4/js/index.js')
    // The XDomainRequest Transport is included for cross-domain file deletion for IE 8 and IE 9
    //if (gte IE 8)&(lt IE 10)
      script(src='/js/vendor/blueimp-file-upload/js/cors/jquery.xdr-transport.js')
    script(type='module').
      // import Pintura Image Editor functionality:
      import { openDefaultEditor } from 'https://cdn.jsdelivr.net/gh/blueimp/jQuery-File-Upload@gh-pages/js/vendor/pintura.min.js';
      $(function () {
      $('#fileupload').fileupload('option', {
      // When editing a file use Pintura Image Editor:
      edit: function (file) {
      return new Promise((resolve, reject) => {
      const editor = openDefaultEditor({
      src: file,
      imageCropAspectRatio: 1,
      });
      editor.on('process', ({ dest }) => {
      resolve(dest);
      });
      editor.on('close', () => {
      resolve(file);
      });
      });
      }
      });
      });
    //a(href='https://pqina.nl/?unlicensed') for use on pqina.nl only
