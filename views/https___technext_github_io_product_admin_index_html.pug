extends layout

block contentHEAD
    meta(http-equiv='Content-Type' content='text/html; charset=UTF-8')
    meta(charset='utf-8')
    meta(content='IE=edge,chrome=1' http-equiv='X-UA-Compatible')
    meta(name='viewport' content='width=device-width, initial-scale=1, maximum-scale=2, user-scalable=no')
    meta(name='description' content='Semantic-UI-Forest, collection of design, themes and templates for Semantic-UI.')
    meta(name='keywords' content='Semantic-UI, Theme, Design, Template')
    meta(name='author' content='PPType')
    meta(name='theme-color' content='#ffffff')
    link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css' type='text/css')
    link(rel='stylesheet' href='https://unpkg.com/bootstrap-table@1.18.3/dist/themes/semantic/bootstrap-table-semantic.min.css' type='text/css')
    link(rel='stylesheet' href='/dashboard/stylesheets/index.css' type='text/css')
    link(rel='stylesheet' href='/stylesheets/bbwizerd.css' type='text/css')
    meta(http-equiv='X-UA-Compatible' content='ie=edge')
    title Product Admin - Dashboard HTML Template
    link(rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto:400,700')
    // https://fonts.google.com/specimen/Roboto
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css')
    //^^^^ link(rel='stylesheet' href='css/fontawesome.min.css')
    // https://fontawesome.com/
    link(rel='stylesheet' href='https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css')
    // https://getbootstrap.com/
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/gh/technext/product-admin/css/templatemo-style.min.css')
    //https://github.com/technext/product-admin/blob/master/css/templatemo-style.css
    //
      Product Admin CSS Template
      https://templatemo.com/tm-524-product-admin
    style(type='text/css').
      /* Chart.js */
      @-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}
    style(type='text/css').
      .dn{display:none;}

block content
    script.
      document.body.id='reportsPage';
    #home
      nav.navbar.navbar-expand-xl
        .container.h-100
          a.navbar-brand(href='index.html')
            h1.tm-site-title.mb-0 電子資源
          button.navbar-toggler.ml-auto.mr-0(type='button' data-toggle='collapse' data-target='#navbarSupportedContent' aria-controls='navbarSupportedContent' aria-expanded='false' aria-label='Toggle navigation')
            i.fas.fa-bars.tm-nav-icon
          #navbarSupportedContent.collapse.navbar-collapse
            ul.navbar-nav.mx-auto.h-100
              if emt==="tab0"
                li.nav-item
                  a.nav-link.active(href='?tab=0')
                    i.warehouse.icon
                    |                                 校內資源
                    span.sr-only (current)
                li.nav-item
                  a.nav-link(href='?tab=1')
                    i.icon.fort.awesome
                    |                                 校外資源
                li.nav-item
                  a.nav-link(href='?tab=2')
                    i.linkify.icon
                    |                                 常用連結
              else if emt==="tab1"
                li.nav-item
                  a.nav-link(href='?tab=0')
                    i.warehouse.icon
                    |                                 校內資源
                li.nav-item
                  a.nav-link.active(href='?tab=1')
                    i.icon.fort.awesome
                    |                                 校外資源
                    span.sr-only (current)
                li.nav-item
                  a.nav-link(href='?tab=2')
                    i.linkify.icon
                    |                                 常用連結
              else if emt==="tab2"
                li.nav-item
                  a.nav-link(href='?tab=0')
                    i.warehouse.icon
                    |                                 校內資源
                li.nav-item
                  a.nav-link(href='?tab=1')
                    i.icon.fort.awesome
                    |                                 校外資源
                li.nav-item
                  a.nav-link.active(href='?tab=2')
                    i.linkify.icon
                    |                                 常用連結
                    span.sr-only (current)
              else
                li.nav-item
                  a.nav-link.active(href='#')
                    i.fas.fa-tachometer-alt
                    |                                 error!
                    span.sr-only (current)
              //li.nav-item.dropdown
                a#navbarDropdown.nav-link.dropdown-toggle(href='#' role='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false')
                  i.fas.fa-cog
                  span
                    | Settings 
                    i.fas.fa-angle-down
                .dropdown-menu(aria-labelledby='navbarDropdown')
                  a.dropdown-item(href='#') Profile
                  a.dropdown-item(href='#') Billing
                  a.dropdown-item(href='#') Customize
            ul.navbar-nav
              li.nav-item
                a.nav-link.d-block(href='/')
                  | &emsp;
                  b 回首頁
      .container
        .row
          .col
            p.text-white.mt-1.mb-1
              | &emsp;
              b &emsp;
        // row
        .row.tm-content-row
          .dn.col-sm-12.col-md-12.col-lg-6.col-xl-6.tm-block-col
            .tm-bg-primary-dark.tm-block
              .chartjs-size-monitor(style='position: absolute; inset: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;')
                .chartjs-size-monitor-expand(style='position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;')
                  div(style='position:absolute;width:1000000px;height:1000000px;left:0;top:0')
                .chartjs-size-monitor-shrink(style='position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;')
                  div(style='position:absolute;width:200%;height:200%;left:0; top:0')
              h2.tm-block-title Latest Hits
              canvas#lineChart.chartjs-render-monitor(style='display: block; height: 390px; width: 640px;' width='800' height='487')
          .dn.col-sm-12.col-md-12.col-lg-6.col-xl-6.tm-block-col
            .tm-bg-primary-dark.tm-block
              .chartjs-size-monitor(style='position: absolute; inset: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;')
                .chartjs-size-monitor-expand(style='position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;')
                  div(style='position:absolute;width:1000000px;height:1000000px;left:0;top:0')
                .chartjs-size-monitor-shrink(style='position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;')
                  div(style='position:absolute;width:200%;height:200%;left:0; top:0')
              h2.tm-block-title Performance
              canvas#barChart.chartjs-render-monitor(style='display: block; height: 390px; width: 640px;' width='800' height='487')
          .dn.col-sm-12.col-md-12.col-lg-6.col-xl-6.tm-block-col
            .tm-bg-primary-dark.tm-block.tm-block-taller
              h2.tm-block-title Storage Information
              #pieChartContainer(style='height: 300px;')
                canvas#pieChart.chartjs-render-monitor(width='863' height='825' style='display: block; height: 300px; width: 314px;')
          .dn.col-sm-12.col-md-12.col-lg-6.col-xl-6.tm-block-col
            .tm-bg-primary-dark.tm-block.tm-block-taller.tm-block-overflow
              h2.tm-block-title Notification List
              .tm-notification-items
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Jessica
                      |  and 
                      b 6 others
                      |  sent you new 
                      a.tm-notification-link(href='#') product updates
                      | . Check new orders.
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Oliver Too
                      |  and 
                      b 6 others
                      |  sent you existing 
                      a.tm-notification-link(href='#') product updates
                      | . Read more reports.
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Victoria
                      |  and 
                      b 6 others
                      |  sent you 
                      a.tm-notification-link(href='#') order updates
                      | . Read order information.
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Laura Cute
                      |  and 
                      b 6 others
                      |  sent you 
                      a.tm-notification-link(href='#') product records
                      | .
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Samantha
                      |  and 
                      b 6 others
                      |  sent you 
                      a.tm-notification-link(href='#') order stuffs
                      | .
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Sophie
                      |  and 
                      b 6 others
                      |  sent you 
                      a.tm-notification-link(href='#') product updates
                      | .
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Lily A
                      |  and 
                      b 6 others
                      |  sent you 
                      a.tm-notification-link(href='#') product updates
                      | .
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Amara
                      |  and 
                      b 6 others
                      |  sent you 
                      a.tm-notification-link(href='#') product updates
                      | .
                    span.tm-small.tm-text-color-secondary 6h ago.
                .media.tm-notification-item
                  .tm-gray-circle
                    img.rounded-circle(src='https://picsum.photos/seed/picsum/80/80' alt='Avatar Image')
                  .media-body
                    p.mb-2
                      b Cinthela
                      |  and 
                      b 6 others
                      |  sent you 
                      a.tm-notification-link(href='#') product updates
                      | .
                    span.tm-small.tm-text-color-secondary 6h ago.
          .col-12.tm-block-col
            .tm-bg-primary-dark.tm-block.tm-block-taller.tm-block-scroll(style='max-height:80vh')
              if emt==="tab0"
                h2.tm-block-title 校內資源
              else if emt==="tab1"
                h2.tm-block-title 校外資源
              else if emt==="tab2"
                h2.tm-block-title 常用連結
              else
                h2.tm-block-title error!
              table.table
                thead
                  if emt==="tab0"
                    tr
                      th(scope='col') 流水號
                      th(scope='col') 名稱
                      th(scope='col') 作者
                      th(scope='col') 資源類型
                      th(scope='col') 發布時間
                      th(scope='col') 備註
                      th(scope='col') 操作
                  else if emt==="tab1"
                    tr
                      th(scope='col') 流水號
                      th(scope='col') 名稱
                      th(scope='col') 提供者
                      th(scope='col') 類型
                      th(scope='col') 發布時間
                      th(scope='col') 備註
                      th(scope='col') 操作
                  else if emt==="tab2"
                    tr
                      th(scope='col') 流水號
                      th(scope='col') 網站名稱
                      th(scope='col') 分類
                      th(scope='col') 超連結
                      th(scope='col') 操作
                  else
                    tr
                      th error!
                tbody
                  if emt==="tab0"
                    each eo, index in e3
                      tr(data-dbno=eo.sn2)
                        //如果編輯要重傳檔案，就直接重新增一份，把原本的刪掉，不然要重hash，不太合理
                        th(scope='row')
                          b= index+1
                        td
                          input.form-control(type="text" value=eo.osn2)
                        td
                          input.form-control(type="text" value=eo.provider2)
                        td
                          // Button trigger modal
                          button.btn.btn-primary(id=`exampleModal${index}bton` type='button' data-toggle='modal' data-target=`#exampleModal${index}` data-firstclass=nqT(String(eo.c2)) data-secclass=nqT(String(eo.Textafterexternallinkother2)))= String(eo.c2)+' '+String(eo.Textafterexternallinkother2)

                          // Modal
                          .modal.fade(id=`exampleModal${index}` tabindex='-1' role='dialog' aria-labelledby=`exampleModal${index}Label` aria-hidden='true')
                            .modal-dialog(role='document')
                              .modal-content.text-dark
                                .modal-header
                                  h5.modal-title(id=`exampleModal${index}Label`) Modal title
                                  button.close(type='button' data-dismiss='modal' aria-label='Close')
                                    span(aria-hidden='true') ×
                                .modal-body
                                  .input-group.mb-3
                                    .input-group-append
                                      span#basic-addon2.input-group-text 主類別
                                    input.form-control.w-50(id=`exampleModal${index}i1` type="text" value=String(eo.c2))
                                  .input-group.mb-3
                                    .input-group-append
                                      span#basic-addon2.input-group-text 子類別
                                    input.form-control.w-50(id=`exampleModal${index}i2` type="text" value=String(eo.Textafterexternallinkother2))
                                .modal-footer
                                  button.btn.btn-secondary(type='button' data-dismiss='modal') 關閉
                                  button.btn.btn-primary(type='button' onclick=`document.getElementById('exampleModal${index}bton').dataset.firstclass=$('#exampleModal${index}i1').val();document.getElementById('exampleModal${index}bton').dataset.secclass=$('#exampleModal${index}i2').val();$('#exampleModal${index}bton').text(String($('#exampleModal${index}i1').val())+String($('#exampleModal${index}i2').val()))`) 暫存

                        td
                          button.btn.btn-secondary(id=`d${index}b` data-db1=String(eo.yPublished_External2) data-db2=String(eo.mPublished_External2) data-db3=String(eo.dPublished_External2) type='button' data-container='body' data-toggle='popover' data-placement='top' data-idonfly=`popover${index}`)= String(eo.yPublished_External2)+'年'+String(eo.mPublished_External2)+'月'+String(eo.dPublished_External2)+'日'
                          .d-none.datetimesetbox
                            .input-group.mb-3
                              //這是一個泡泡展開，需要這個html末端的泡泡fucn
                              input.form-control.w-50(class=`d${index}b1` type="text" value=String(eo.yPublished_External2))
                              .input-group-append
                                span#basic-addon2.input-group-text 年
                            .input-group.mb-3
                              input.form-control.w-50(class=`d${index}b2` type="text" value=String(eo.mPublished_External2))
                              .input-group-append
                                span#basic-addon2.input-group-text 月
                            .input-group.mb-3
                              input.form-control.w-50(class=`d${index}b3` type="text" value=String(eo.dPublished_External2))
                              .input-group-append
                                span#basic-addon2.input-group-text 日
                            .d-flex.bd-highlight.mb-3
                              .p-2.flex-fill.bd-highlight
                                button.btn.btn-secondary(type='button' onclick=`$('button[data-idonfly=popover${index}]').click()`) 關閉
                              .p-2.flex-fill.bd-highlight
                                button.btn.btn-primary(type='button' onclick=`var t=document.getElementById('d${index}b');t.dataset.db1=$('.d${index}b1').last().val();t.dataset.db2=$('.d${index}b2').last().val();t.dataset.db3=$('.d${index}b3').last().val();t.innerText=$('.d${index}b1').last().val()+'年'+$('.d${index}b2').last().val()+'月'+$('.d${index}b3').last().val()+'日'`) 暫存
                        td
                          input.form-control(type="text" value=eo.Remarks_External2)
                        td
                          .tm-status-circle.moving
                          button.ui.button(href="#" onclick=`$.ajax({url: 'ocr?id=${eo.id||'-1'}',type: 'DELETE',success: function(result) { window.location.href='/main/editR?tab=0'},error:function(result) { Swal.fire({  title: '錯誤!',  text: result,  icon: 'error',  confirmButtonText: 'Cool'});}});`)
                            i.save.icon
                            |   刪除
                          button.ui.button(href="#" onclick='')
                            i.save.icon
                            |   編輯
                  else if emt==="tab1"
                    each eo, index in e2
                      tr(data-dbno=eo.sn)
                        th(scope='row')
                          b= index+1
                          //.tm-status-circle.pending
                        td= eo.osn
                        td
                          b= eo.provider
                        td
                          b= String(eo.c)+' '+String(eo.Textafterexternallinkother)
                        td
                          b= String(eo.yPublished_External)+'年'+String(eo.mPublished_External)+'月'+String(eo.dPublished_External)+'日'
                        td= eo.Remarks_External
                        td
                          .tm-status-circle.moving
                          a.ui.button(href="#" onclick=`$.ajax({url: 'fcr?id=${eo.id||'-1'}',type: 'DELETE',success: function(result) { window.location.href='/main/editR?tab=1'},error:function(result) { Swal.fire({  title: '錯誤',  text: result,  icon: 'error',  confirmButtonText: 'Cool'});}});`)
                            i.external.alternate.icon
                            |   刪除
                  else if emt==="tab2"
                    each eo, index in e1
                      tr(data-dbno=eo.no)
                        th(scope='row')
                          b= index+1
                          //.tm-status-circle.pending
                        td
                          input.form-control(id=`erl${index}db1` type="text" value=eo.name) 
                        td
                          input.form-control(id=`erl${index}db2` type="text" value=eo.subcategory)
                        td
                          input.form-control(id=`erl${index}db3` type="text" value=eo.url)
                        td
                          .tm-status-circle.moving
                          a.ui.button(id=`erl${index}db0` href="#" onclick=`$.ajax({url: 'frequentlyUsedLinks?id=${eo.id||'-1'}',type: 'DELETE',success: function(result) { window.location.href='/main/editR?tab=2'},error:function(result) { Swal.fire({  title: '錯誤',  text: result,  icon: 'error',  confirmButtonText: 'Cool'});}});`)
                            i.external.alternate.icon
                            |   刪除
                          a.ui.button(href="#" onclick=` $.post("/main/e1", {no: '${eo.no}',name: $('#erl${index}db1').val(),subcategory: $('#erl${index}db2').val(),url: $('#erl${index}db3').val(),submit: '送出'}, (res) => {if (res.includes('資料寫入成功!')) {console.log('OK');document.getElementById('erl${index}db0').click();} else {console.log('X');Swal.fire('錯誤','資料寫入錯誤,保持原始狀態','error');} });`)
                            i.external.alternate.icon
                            |   編輯
                  else
                    tr
                      th error!
      footer.tm-footer.row.tm-mt-small
        .col-12.font-weight-light
          p.text-center.text-white.mb-0.px-4.small
            | 資料庫最後更新時間:
            b= ly
            //a.tm-footer-link(rel='nofollow noopener' href='https://templatemo.com') Template Mo
    script(src='https://code.jquery.com/jquery-3.6.0.min.js' integrity='sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=' crossorigin='anonymous')
    // https://jquery.com/download/
    script(src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js')
    // https://momentjs.com/
    script(src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js' integrity='sha512-GsqF810cNwHMCDELTwi3YgWIBwKYQlvC1WTAJ6fk80rtB6zN3IWdpoQujBQCuOMOxXXksEWwE0k4Lrb+N87DZQ==' crossorigin='anonymous' referrerpolicy='no-referrer')
    // http://www.chartjs.org/docs/latest/
    script(src='https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js')
    //2.11.4not ok(https://getbootstrap.com/docs/4.1/components/popovers/)
    script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js' integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy' crossorigin='anonymous')
    // https://getbootstrap.com/
    script(src='https://cdn.jsdelivr.net/gh/technext/product-admin/js/tooplate-scripts.js')
    script.
      Chart.defaults.global.defaultFontColor = 'white';
      let ctxLine,
      ctxBar,
      ctxPie,
      optionsLine,
      optionsBar,
      optionsPie,
      configLine,
      configBar,
      configPie,
      lineChart;
      barChart, pieChart;
      // DOM is ready
      $(function () {
      drawLineChart(); // Line Chart
      drawBarChart(); // Bar Chart
      drawPieChart(); // Pie Chart
      $(window).resize(function () {
      updateLineChart();
      updateBarChart();
      });
      });
      $(function () {//https://getbootstrap.com/docs/4.1/components/popovers/
      //泡泡fucn
      $('[data-toggle="popover"]').popover({
      html: true,
      content:function (){var stuff = $( this ).parent().children('.datetimesetbox');var tmp=stuff[0].innerHTML;return tmp;
      }
      });
      });
    script(src='//cdn.jsdelivr.net/npm/sweetalert2@11')
    script(src='https://cdn.jsdelivr.net/npm/sweetalert2@11.4.8/dist/sweetalert2.all.min.js' integrity='sha256-aHuHTU7SdMUuRBFzJX+PRkbfy9kd0uGHS8uc4M/NVBo=' crossorigin='anonymous')
    script(src='/rs/index.js')


